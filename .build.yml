image: openbsd/7.5
shell: true
secrets:
  - b2b00838-c8a8-441d-baaa-da121489d0bd
sources:
  - git@git.sr.ht:~robertkeizer/bgpipe
  - https://github.com/bgpfix/bgpfix.git
packages:
  - go
tasks:
  - install: |
      cd bgpipe
      go install .
  - setup_vether: |
      ifconfig vether0 198.51.100.1 255.255.255.255 up
  - setup_bgpd: |
      cat <<EOF>/etc/bgpd.conf
        AS 65001
        router-id 198.51.100.1

        listen on 198.51.100.1 port 179
        network 198.51.100.0/24

        neighbor 192.0.2.1 {
          remote-as 65002
        }

        allow from 192.0.2.1
        allow to 192.0.2.1
      EOF

      bgpd -vnf /etc/bgpd.conf
      rcctl enable bgpd
      rcctl start bgpd
